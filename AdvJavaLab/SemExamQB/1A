package mypackage;
import java.sql.*;
import java.sql.Connection;
import java.sql.DriverManager;

public class Department {
	private static final String SERVER_URL = "jdbc:mysql://localhost:3306/";
	private static final String DB_URL = "jdbc:mysql://localhost:3306/Employee";
	private static final String USER = "root";
	private static final String PASS = "";
	
	public static void main(String[] args) {
		Connection conn = null;
		Statement stmt = null;
		PreparedStatement pstmt = null;
		
		
		try {
			
			conn = DriverManager.getConnection(SERVER_URL,USER,PASS);
			stmt = conn.createStatement();
			
			String createDatabaseSQL = "CREATE DATABASE IF NOT EXISTS Employee";
			stmt.executeUpdate(createDatabaseSQL);
			System.out.println("Created or already exists");
			
			conn.close();
			conn = DriverManager.getConnection(DB_URL,USER,PASS);
			stmt = conn.createStatement();
			
			String createTableSQL = "CREATE TABLE IF NOT EXISTS Department( " +
					"Dept_ID INT PRIMARY KEY, " +
					"Name VARCHAR(100), " +
					"Year_Established INT, " +
					"Head_Name VARCHAR(100), " +
					"No_of_Employees INT)";
			stmt.executeUpdate(createTableSQL);
			System.out.println("Table created if it doesnt already exist");
			
			String insertDataSQL = "INSERT INTO Department (Dept_ID, Name, Year_Established, Head_Name, No_of_Employees) VALUES " +
					"(1,'CSE',2000,'Naidu',40), " +
					"(2,'CY',2020,'Thippeswamy',10), " +
					"(3,'ECE',1980,'Singh',20), " +
					"(4,'AIML',2015,'Gowda',15), " +
					"(5, 'AIDS', 2018, 'Shetty', 20)";
			stmt.executeUpdate(insertDataSQL);
			System.out.println("Data Inserted");
			
			String displayAll = "SELECT * FROM Department";
			ResultSet rsAll = stmt.executeQuery(displayAll);
			System.out.println("Dept_ID\tName\tYear_Established\tHead_Name\tNo_of_Employees");
			while (rsAll.next()) {
				System.out.println(rsAll.getInt("Dept_ID") + "\t" + rsAll.getString("Name") + "\t" + rsAll.getInt("Year_Established") + "\t" + rsAll.getString("Head_Name") + "\t" + rsAll.getInt("No_of_Employees"));
			}
			
			String display2000 = "SELECT * FROM Department WHERE Year_Established = ?";
			pstmt = conn.prepareStatement(display2000);
			pstmt.setInt(1, 2000);
			ResultSet rs2000 = pstmt.executeQuery();
			System.out.println("Dept_ID\tName\tYear\tHead_Name\tNo_of_Employees");
			while (rs2000.next()) {
				System.out.println(rs2000.getInt("Dept_ID") + "\t" + rs2000.getString("Name") + "\t" + rs2000.getInt("Year_Established") + "\t" + rs2000.getString("Head_Name") + "\t" + rs2000.getInt("No_of_Employees"));
			}
			
			String displayDept = "SELECT * FROM Department WHERE Dept_ID = ? AND Name = ?";
			pstmt = conn.prepareStatement(displayDept);
			pstmt.setInt(1, 2);
			pstmt.setString(2, "CY");
			ResultSet rsDept = pstmt.executeQuery();
			System.out.println("Dept_ID\tName\tYear_Established\tHead_Name\tNo_of_Employees");
			while (rsDept.next()) {
				System.out.println(rsDept.getInt("Dept_ID") + "\t" + rsDept.getString("Name") + "\t" + rsDept.getInt("Year_Established") + "\t" + rsDept.getString("Head_Name") + "\t" + rsDept.getInt("No_of_Employees"));
			}		
			
			String insertNewRowSQL = "INSERT INTO Department (Dept_ID, Name, Year_Established, Head_Name, No_of_Employees) VALUES (?,?,?,?,?)";
			pstmt = conn.prepareStatement(insertNewRowSQL);
			pstmt.setInt(1, 6);
			pstmt.setString(2, "EEE");
			pstmt.setInt(3, 1990);
			pstmt.setString(4, "Reddy");
			pstmt.setInt(5, 20);
			pstmt.executeUpdate();
			System.out.println("Inserted new row using prepared statement");
		}
		catch (SQLException e) {
			e.printStackTrace();
		}
		finally {
			try {
				if (stmt != null) {
					stmt.close();
				}
				if (pstmt != null) {
					pstmt.close();
				}
				if (conn != null) {
					conn.close();
				}
			}
			catch (SQLException e) {
				e.printStackTrace();
			}
		}
	}
}
